(()=>{var e,t={113:()=>{!function(){if("undefined"==typeof wp||!wp.blocks)return void console.error("Amazon Product Block: WordPress blocks not available");const{registerBlockType:e}=wp.blocks,{InspectorControls:t,useBlockProps:o}=wp.blockEditor||{},{PanelBody:a,TextControl:r,Button:n,Spinner:c,Notice:l,ToggleControl:s}=wp.components||{},{useState:d,useEffect:i}=wp.element||{};if(!(e&&t&&o&&a&&r&&n&&d&&i))return void console.error("Amazon Product Block: Required WordPress components not available");console.log("Amazon Product Block: All dependencies loaded, registering block...");const m=e=>!!e&&(/amazon\.(com|co\.uk|de|fr|it|es|ca|com\.au|co\.jp|in|com\.br|com\.mx)\/.*\/dp\/[A-Z0-9]{10}/i.test(e)||/amzn\.to\/[A-Za-z0-9]+/i.test(e)||e.includes("/dp/")||e.includes("/gp/product/"));try{e("amazon-product/block",{title:"Amazon Product",description:"Display an Amazon product with image, title, price, and buy button",category:"embed",icon:"cart",supports:{html:!1},attributes:{productUrl:{type:"string",default:""},productData:{type:"object",default:{}},autoFetch:{type:"boolean",default:!0},lastFetched:{type:"number",default:0}},edit:function(e){const{attributes:u,setAttributes:p}=e,{productUrl:w,productData:f,autoFetch:h,lastFetched:g}=u,[b,v]=d(!1),[z,k]=d(""),[y,P]=d(null),E=o({className:"amazon-product-block-editor"}),A=async(e=w,t=!1)=>{if(console.log("fetchProductData called with URL:",e),e)if(m(e)){if(!window.amazonProductBlock)return console.error("amazonProductBlock not found on window object"),void(t||k("Amazon Product Block not properly initialized. Please check your API settings."));console.log("amazonProductBlock object:",window.amazonProductBlock),t||v(!0),k("");try{const o=new FormData;o.append("action","fetch_amazon_product"),o.append("productUrl",e),o.append("nonce",window.amazonProductBlock.nonce),console.log("Sending request to:",window.amazonProductBlock.ajaxUrl);const a=await fetch(window.amazonProductBlock.ajaxUrl,{method:"POST",body:o});if(console.log("Response status:",a.status),!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const r=await a.json();if(console.log("Response result:",r),r.success){console.log("Product data received:",r.data);const e={...r.data,fetchedAt:Date.now()};p({productData:e,lastFetched:Date.now()}),k(""),console.log("Product data set successfully:",e)}else{const e=r.data||"Failed to fetch product data";console.error("Server returned error:",e),t||k(e),t||p({productData:{}})}}catch(e){console.error("Fetch error details:",e),t||k(`Network error: ${e.message}`),t||p({productData:{}})}finally{t||v(!1)}}else t||k("Please enter a valid Amazon product URL");else t||k("Please enter a product URL")};i((()=>{if(y&&clearTimeout(y),w&&h&&m(w)){const e=setTimeout((()=>{A(w,!0)}),1e3);P(e)}return()=>{y&&clearTimeout(y)}}),[w,h]),i((()=>{if(!h||!w||!e.isSelected)return;const t=setInterval((()=>{Date.now()-g>3e5&&(console.log("Auto-refreshing product data..."),A(w,!0))}),6e4);return()=>clearInterval(t)}),[w,h,g,e.isSelected]);const B=f&&Object.keys(f).length>0,D=B&&f.fetchedAt?Math.floor((Date.now()-f.fetchedAt)/6e4):0;return wp.element.createElement("div",E,wp.element.createElement(t,{},wp.element.createElement(a,{title:"Product Settings"},wp.element.createElement(r,{label:"Amazon Product URL",value:w,onChange:e=>{p({productUrl:e}),e||(p({productData:{}}),k(""))},placeholder:"https://www.amazon.com/dp/ASIN",help:"Enter the full Amazon product URL. Data will fetch automatically."}),wp.element.createElement(s,{label:"Auto-fetch product data",checked:h,onChange:e=>p({autoFetch:e}),help:"Automatically fetch product data when URL changes and refresh periodically"}),wp.element.createElement("div",{style:{marginTop:"15px"}},wp.element.createElement(n,{isPrimary:!0,onClick:()=>{A(w,!1)},disabled:!w||b,style:{marginRight:"10px"}},b?"Refreshing...":"Refresh Data"),B&&D>0&&wp.element.createElement("small",{style:{display:"block",marginTop:"5px",color:D>60?"#d94f4f":"#666",fontStyle:"italic"}},`Data is ${D} minute${1!==D?"s":""} old`)))),wp.element.createElement("div",{className:"amazon-product-block-placeholder"},z&&wp.element.createElement(l,{status:"error",isDismissible:!1},z),!B&&!b&&wp.element.createElement("div",{className:"amazon-product-empty-state"},wp.element.createElement("div",{className:"amazon-product-icon"},"ðŸ›’"),wp.element.createElement("h3",{},"Amazon Product Block"),wp.element.createElement("p",{},h?"Enter an Amazon product URL above and data will be fetched automatically.":'Enter an Amazon product URL in the block settings and click "Refresh Data".')),b&&wp.element.createElement("div",{className:"amazon-product-loading"},wp.element.createElement(c),wp.element.createElement("p",{},"Fetching product data...")),B&&wp.element.createElement("div",{className:"amazon-product-preview"},wp.element.createElement("div",{className:"amazon-product-card"},f.image&&wp.element.createElement("div",{className:"amazon-product-image"},wp.element.createElement("img",{src:f.image,alt:f.title||"Product Image"})),wp.element.createElement("div",{className:"amazon-product-content"},f.title&&wp.element.createElement("h3",{className:"amazon-product-title"},f.title),f.price&&wp.element.createElement("div",{className:"amazon-product-price"},f.price),wp.element.createElement("div",{className:"amazon-product-button"},"Buy Now on Amazon"))))))},save:function(){return null}}),console.log("Amazon Product Block: Block registered successfully")}catch(e){console.error("Amazon Product Block: Registration failed:",e)}}()},980:(e,t,o)=>{"use strict";o(113)}},o={};function a(e){var r=o[e];if(void 0!==r)return r.exports;var n=o[e]={exports:{}};return t[e](n,n.exports,a),n.exports}a.m=t,e=[],a.O=(t,o,r,n)=>{if(!o){var c=1/0;for(i=0;i<e.length;i++){for(var[o,r,n]=e[i],l=!0,s=0;s<o.length;s++)(!1&n||c>=n)&&Object.keys(a.O).every((e=>a.O[e](o[s])))?o.splice(s--,1):(l=!1,n<c&&(c=n));if(l){e.splice(i--,1);var d=r();void 0!==d&&(t=d)}}return t}n=n||0;for(var i=e.length;i>0&&e[i-1][2]>n;i--)e[i]=e[i-1];e[i]=[o,r,n]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var o in t)a.o(t,o)&&!a.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={57:0,350:0};a.O.j=t=>0===e[t];var t=(t,o)=>{var r,n,[c,l,s]=o,d=0;if(c.some((t=>0!==e[t]))){for(r in l)a.o(l,r)&&(a.m[r]=l[r]);if(s)var i=s(a)}for(t&&t(o);d<c.length;d++)n=c[d],a.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return a.O(i)},o=globalThis.webpackChunkamazon_product_block=globalThis.webpackChunkamazon_product_block||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var r=a.O(void 0,[350],(()=>a(980)));r=a.O(r)})();